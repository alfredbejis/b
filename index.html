<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TrasLaFactura — Revisión gratuita de tu factura de luz</title>
<meta name="description" content="Análisis profesional y sin coste de tu factura de luz. Detectamos sobrecostes y te proponemos un plan claro para pagar menos." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
<!-- GSAP (solo para entrance timeline) -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<style>
  :root{
    --bg:#0b0b0b; --ink:#f6f7fb; --muted:#c9ced7;
    --accent:#77e3a1; --accent-700:#46c27a;
    --line:rgba(255,255,255,.06);
    --glass: rgba(255,255,255,0.02);
    --maxw:980px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; -webkit-font-smoothing:antialiased}
  a{color:var(--accent)}
  .aura{position:fixed;inset:0;z-index:-1;pointer-events:none;background:
    radial-gradient(60vmax 35vmax at 20% 15%, rgba(80,220,150,.10), transparent 60%),
    radial-gradient(50vmax 30vmax at 80% 20%, rgba(190,255,220,.07), transparent 60%),
    linear-gradient(180deg,#0b0b0b 0%,#0e0e0e 60%);filter:blur(.4px) saturate(1.02)}
  .aura::before,.aura::after{content:"";position:absolute;inset:-10%;mix-blend-mode:screen;filter:blur(18px);opacity:.6;
    background:radial-gradient(22rem 8rem at 20% 30%, rgba(40,210,120,.35), transparent 65%), radial-gradient(26rem 9rem at 80% 60%, rgba(190,255,220,.30), transparent 65%);animation:auraMove 22s linear infinite}
  .aura::after{animation-direction:reverse;opacity:.45;animation-duration:30s}
  @keyframes auraMove{0%{transform:translate(-3%,-2%) rotate(0)}50%{transform:translate(3%,2%) rotate(180deg)}100%{transform:translate(-3%,-2%) rotate(360deg)}}
  @media (prefers-reduced-motion: reduce){ .aura::before,.aura::after{animation:none} }

  /* center page */
  .wrap{min-height:100svh;min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:30px}
  .page{width:min(var(--maxw),96vw);margin:0 auto;text-align:center;position:relative}

  header{margin-bottom:18px}
  .logo{display:inline-flex;align-items:center;gap:12px}
  .logo img{height:36px}

  h1{font-size:clamp(28px,5.2vw,44px);margin:8px 0 6px;font-weight:900;line-height:1}
  p.lead{color:var(--muted);margin:0 auto 18px;max-width:820px}

  .ctas{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:18px}
  .btn{display:inline-flex;align-items:center;gap:10px;padding:.85rem 1.1rem;border-radius:12px;border:0;font-weight:800;cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#d8ffea);color:#05231a}
  .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}

  /* main card */
  .card{background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.01));border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.6);display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}
  @media (max-width:980px){ .card{grid-template-columns:1fr;padding:14px} }

  /* left content */
  .left { padding:12px; display:flex;flex-direction:column;gap:12px; align-items:center; justify-content:center; }
  .decrypted{font-weight:800;font-size:clamp(16px,2.2vw,22px);color:var(--accent)}

  /* TRUE FOCUS styles (vanilla implementation) */
  .tf-container{position:relative; display:inline-flex; gap:10px; align-items:center; justify-content:center; padding:6px 8px}
  .tf-word{position:relative; display:inline-block; padding:6px 10px; border-radius:8px; font-weight:900; color:#fff; cursor:default; transition: filter .45s ease}
  .tf-word.inactive{opacity:.9}
  /* focus frame */
  .tf-frame{position:absolute; left:0; top:0; transform-origin:0 0; pointer-events:none; border-radius:10px; box-shadow:0 8px 30px rgba(24,169,87,.12); border:2px solid rgba(255,255,255,.95); transition:all .45s cubic-bezier(.22,1,.36,1); z-index:0; overflow:visible; background:transparent}
  /* corners */
  .tf-corner{position:absolute;width:10px;height:10px; border:2px solid var(--frame-border, #fff); background:transparent}
  .tf-corner.tl{left:-6px;top:-6px;border-right:none;border-bottom:none}
  .tf-corner.tr{right:-6px;top:-6px;border-left:none;border-bottom:none}
  .tf-corner.bl{left:-6px;bottom:-6px;border-right:none;border-top:none}
  .tf-corner.br{right:-6px;bottom:-6px;border-left:none;border-top:none}

  /* right side: form */
  .right{position:relative;padding:8px}
  .flow{position:absolute;inset:-25%;z-index:0;filter:blur(14px) saturate(1.05);pointer-events:none;background:
    radial-gradient(22rem 8rem at 20% 30%, rgba(40,210,120,.38), transparent 65%),
    radial-gradient(26rem 9rem at 80% 60%, rgba(190,255,220,.28), transparent 65%); animation:flow 16s linear infinite}
  @keyframes flow{0%{transform:translate(-4%,-3%) rotate(0)}50%{transform:translate(4%,3%) rotate(180deg)}100%{transform:translate(-4%,-3%) rotate(360deg)}}
  @media (prefers-reduced-motion: reduce){ .flow{animation:none} }

  .form-inner{position:relative;z-index:1}
  label{display:block;font-weight:700;margin-bottom:6px;color:#eaf8ee}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.06);background:#0f1010;color:var(--ink)}
  .small{font-size:13px;color:var(--muted);margin-top:8px}

  /* metrics compact */
  .metrics{display:flex;flex-direction:column;gap:10px;align-items:center}
  .rings{display:flex;gap:12px;align-items:center}
  .ring-outer{width:120px;height:120px;border-radius:50%;display:grid;place-items:center;background:radial-gradient(circle at center, rgba(255,255,255,.02), transparent 60%);position:relative;overflow:visible}
  .ring-rot{position:absolute;inset:0;border-radius:50%;will-change:transform}
  .ring-rot span{position:absolute;left:50%;top:50%;transform-origin:0 0;font-size:12px;letter-spacing:1px;color:#dff7e6}
  .center-stat{position:relative;z-index:2;background:rgba(255,255,255,.02);padding:8px;border-radius:10px}

  /* testimonials marquee */
  .testi-wrap{margin-top:18px;border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));border:1px solid var(--line);overflow:hidden;position:relative}
  .testi-glow{position:absolute;inset:-10%;pointer-events:none;mix-blend-mode:screen;filter:blur(20px);opacity:.6;background:
    radial-gradient(26rem 9rem at 20% 60%, rgba(40,210,120,.28), transparent 65%), radial-gradient(24rem 8rem at 80% 40%, rgba(190,255,220,.22), transparent 65%)}
  .marquee{display:flex;gap:16px;will-change:transform;padding:8px 0}
  .tcard{min-width:300px;max-width:300px;background:#0f1310;border:1px solid var(--line);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.45)}
  .tcard .who{display:flex;align-items:center;gap:10px;margin-bottom:8px}
  .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(180deg,#17a457,#0e7c3f)}
  .name{font-weight:800}
  .stars{color:#e6ffef;font-size:14px}
  .when{color:var(--muted);font-size:12px}
  .text{color:#dff7e6;font-size:14px;line-height:1.4}

  /* entrance fade (fallback if GSAP missing) */
  .fade-in{opacity:0;transform:translateY(8px)}
  @media (prefers-reduced-motion: reduce){ .fade-in{opacity:1;transform:none} }
</style>
</head>
<body>
  <div class="aura" aria-hidden="true"></div>

  <div class="wrap">
    <main class="page fade-in" id="page">
      <header><div class="logo"><img src="https://storage.googleapis.com/msgsndr/JGkHaKDrqyLJGaAenUBK/media/68f7c75b57ab4837ff3fa0f8.png" alt="TrasLaFactura"></div></header>

      <h1 id="main-title">Revisión profesional para <span style="color:var(--accent)">pagar menos</span></h1>
      <p class="lead">Analizamos tu contrato y consumos para detectar sobrecostes y proponerte un plan claro, sin letra pequeña.</p>

      <div class="ctas">
        <button class="btn primary" id="cta-top">Quiero mi revisión gratuita</button>
        <button class="btn ghost" id="cta-book">Reservar 10’</button>
      </div>

      <div class="card" id="main-card">
        <!-- LEFT: messaging, TF, metrics, testimonials -->
        <div class="left" aria-hidden="false">
          <div class="decrypted" id="decrypted">•••••••••••••••••••••••••••••••••••••••••••••</div>

          <!-- TRUE FOCUS: we'll initialize it with JS -->
          <div style="margin-top:10px">
            <div id="true-focus" class="tf-container" aria-hidden="false" 
                 data-sentence="Analizamos tu factura y ENCONTRAMOS SOBRECOSTES que puedes evitar"
                 data-manual="false"
                 data-blur="4"
                 data-border="#ffffff"
                 data-glow="rgba(255,255,255,0.12)"
                 data-duration="0.45"
                 data-pause="1.2">
              <!-- words injected by JS -->
              <div id="tf-frame" class="tf-frame" aria-hidden="true">
                <span class="tf-corner tl"></span>
                <span class="tf-corner tr"></span>
                <span class="tf-corner bl"></span>
                <span class="tf-corner br"></span>
              </div>
            </div>
          </div>

          <!-- metrics -->
          <div class="metrics" style="margin-top:12px;align-items:center">
            <div class="rings">
              <div class="ring-outer" aria-hidden="true"><div class="ring-rot" data-ring-text="+100.000 CLIENTES •"></div></div>
              <div class="ring-outer" aria-hidden="true"><div class="ring-rot" data-ring-text="+15 AÑOS DE EXPERIENCIA •"></div></div>
            </div>
            <div style="margin-top:8px;color:var(--muted)">Confianza basada en experiencia real</div>
          </div>

          <!-- testimonials -->
          <div class="testi-wrap" style="margin-top:14px;">
            <div class="testi-glow" aria-hidden="true"></div>
            <div class="marquee" id="marquee">
              <!-- content injected by JS -->
            </div>
          </div>
        </div>

        <!-- RIGHT: form -->
        <aside class="right">
          <div class="flow" aria-hidden="true"></div>
          <div class="form-inner">
            <h3 style="margin:0 0 8px">Solicitar revisión gratuita</h3>
            <div style="margin-bottom:8px;color:var(--muted);font-size:13px">Rellena en 2 minutos y te contactamos</div>
            <form id="lead" novalidate>
              <label for="name">Nombre</label>
              <input id="name" name="name" type="text" required autocomplete="name" />

              <label for="phone" style="margin-top:10px">Teléfono</label>
              <input id="phone" name="phone" type="tel" required autocomplete="tel" />

              <label for="email" style="margin-top:10px">Email (opcional)</label>
              <input id="email" name="email" type="email" autocomplete="email" />

              <div style="display:flex;gap:8px;margin-top:12px">
                <button class="btn primary" id="submit" type="button">Enviar solicitud</button>
                <button class="btn ghost" id="book-right" type="button">Reservar 10’</button>
              </div>
              <div class="small" id="form-msg" style="margin-top:10px"></div>
            </form>
          </div>
        </aside>
      </div>
    </main>
  </div>

<script>
/* ===== Respect reduced motion ===== */
const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

/* ===== Entrance animation (GSAP) - page fade in and staggered children ===== */
window.addEventListener('load', ()=> {
  const page = document.getElementById('page');
  if (prefersReduced || typeof gsap === 'undefined') {
    page.style.opacity = '1';
    page.style.transform = 'none';
    return;
  }
  gsap.timeline()
    .from(page, {opacity:0, y:10, duration:0.6, ease:'power2.out'})
    .from('#main-card > .left > *:not(.decrypted)', {opacity:0, y:12, stagger:0.08, duration:0.5}, "-=0.35");
});

/* ===== Decrypted text (vanilla) ===== */
(function(){
  const el = document.getElementById('decrypted');
  const final = "Te ayudamos a entender la factura de la luz, y lo más importante, que AHORRES";
  if (prefersReduced) { el.textContent = final; return; }
  const chars = "-_~`!@#$%^&*()+=[]{}|;:,.<>/?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let frame = 0;
  const out = final.split("").map(()=>({ch:"", lock:false}));
  const timer = setInterval(()=>{
    let done=0;
    for (let i=0;i<out.length;i++){
      if (final[i]===" "){ out[i]={ch:" ", lock:true}; done++; continue; }
      if (!out[i].lock){
        if (frame > i + Math.random()*14) out[i]={ch:final[i], lock:true};
        else out[i]={ch: chars[Math.floor(Math.random()*chars.length)], lock:false};
      } else done++;
    }
    el.textContent = out.map(o=>o.ch).join("");
    if (done === out.length) clearInterval(timer);
    frame++;
  }, 22);
})();

/* ===== True Focus (vanilla implementation adapted from your React component) =====
   Usage driven by data attributes on #true-focus:
   data-sentence, data-manual, data-blur, data-border, data-glow, data-duration, data-pause
*/
(function(){
  const container = document.getElementById('true-focus');
  if(!container) return;
  const sentence = container.dataset.sentence || 'True Focus';
  const manualMode = (container.dataset.manual === 'true');
  const blurAmount = parseFloat(container.dataset.blur || '5');
  const borderColor = container.dataset.border || '#ffffff';
  const glowColor = container.dataset.glow || 'rgba(0,255,0,0.12)';
  const animDuration = parseFloat(container.dataset.duration || '0.45') * 1000;
  const pauseBetween = parseFloat(container.dataset.pause || '1.2') * 1000;

  // prepare words
  const words = sentence.split(' ').filter(Boolean);
  container.innerHTML = ''; // clear
  const frame = document.createElement('div'); frame.className = 'tf-frame'; frame.style.borderColor = borderColor; frame.style.boxShadow = `0 8px 30px ${glowColor}`; frame.style.transition = `all ${animDuration/1000}s cubic-bezier(.22,1,.36,1)`; container.appendChild(frame);
  // corners
  ['tl','tr','bl','br'].forEach(c=>{
    const span = document.createElement('span'); span.className = 'tf-corner '+c; span.style.borderColor = borderColor; frame.appendChild(span);
  });

  const wordNodes = [];
  words.forEach((w, i) => {
    const span = document.createElement('span');
    span.className = 'tf-word';
    span.textContent = w;
    // default blur for non-active
    span.style.filter = `blur(${blurAmount}px)`;
    span.style.transition = `filter ${animDuration/1000}s ease, opacity ${animDuration/1000}s ease`;
    // wrap spacing
    container.appendChild(span);
    wordNodes.push(span);
    // mouse interactions
    span.addEventListener('mouseenter', ()=> {
      if (manualMode) setActive(i, true);
    });
    span.addEventListener('mouseleave', ()=> {
      if (manualMode) setActive(currentIndexBeforeHover ?? 0, true);
    });
  });

  // positioning / sizing
  const getParentRect = () => container.getBoundingClientRect();

  let current = 0;
  let currentIndexBeforeHover = 0;
  let intervalId = null;

  function setActive(index, instant){
    if (index < 0 || index >= wordNodes.length) return;
    current = index;
    // blur others & unblur active
    wordNodes.forEach((n, i)=> {
      if (i === index) {
        n.style.filter = 'blur(0px)';
      } else {
        n.style.filter = `blur(${blurAmount}px)`;
      }
    });

    // compute position relative to container
    const parentRect = getParentRect();
    const activeRect = wordNodes[index].getBoundingClientRect();
    const x = activeRect.left - parentRect.left - 6; // small offset so frame slightly larger
    const y = activeRect.top - parentRect.top - 6;
    const w = Math.max(24, activeRect.width + 12);
    const h = Math.max(18, activeRect.height + 8);

    // apply to frame
    if (instant) {
      frame.style.transition = 'none';
      frame.style.left = x + 'px';
      frame.style.top = y + 'px';
      frame.style.width = w + 'px';
      frame.style.height = h + 'px';
      // force reflow then restore transition for future
      void frame.offsetWidth;
      frame.style.transition = `all ${animDuration/1000}s cubic-bezier(.22,1,.36,1)`;
    } else {
      frame.style.left = x + 'px';
      frame.style.top = y + 'px';
      frame.style.width = w + 'px';
      frame.style.height = h + 'px';
    }
  }

  // initial layout - place words inline with spacing preserved
  // ensure container size fits
  setTimeout(()=> {
    // small delay to ensure layout done
    wordNodes.forEach(n => n.style.display = 'inline-block');
    setActive(0, true);
  }, 20);

  // automated cycling if not manual
  if (!manualMode && !prefersReduced) {
    intervalId = setInterval(()=> {
      const next = (current + 1) % wordNodes.length;
      setActive(next, false);
    }, animDuration + pauseBetween);
  }

  // responsive: recompute on resize
  window.addEventListener('resize', ()=> setActive(current, true));

})();

/* ===== Rings rotation (rAF) for metrics - smooth, no cut on hover ===== */
(function(){
  function buildRingText(el, text) {
    el.innerHTML = '';
    const chars = Array.from(text);
    const total = chars.length;
    chars.forEach((ch, i) => {
      const s = document.createElement('span');
      const angle = (360 / total) * i;
      s.style.transform = `translate(-50%,-50%) rotate(${angle}deg) translate(68px) rotate(${-angle}deg)`;
      s.textContent = ch;
      el.appendChild(s);
    });
  }
  function spin(el, rps){
    if (prefersReduced) return;
    let last = performance.now();
    let factor = 1, target = 1;
    function tick(now){
      const dt = (now - last) / 1000; last = now;
      factor += (target - factor) * 0.08;
      const prev = parseFloat(el._angle || 0);
      const next = prev + (rps * factor * 360 * dt);
      el._angle = next % 360;
      el.style.transform = `rotate(${el._angle}deg)`;
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
    el.addEventListener('mouseenter', ()=> target = 3.5);
    el.addEventListener('mouseleave', ()=> target = 1);
  }
  document.querySelectorAll('[data-ring-text]').forEach(el=>{
    buildRingText(el, el.dataset.ringText);
    spin(el, 0.65);
  });
})();

/* ===== Testimonials marquee (continuous, 4 reviews incl. yours) ===== */
(function(){
  const REVIEWS = [
    {
      name: "Álvaro Clemente",
      rating: 5,
      when: "2025",
      text: "Al principio revisamos la factura de mi casa, pensando que alomejor habia que hacer un leve ajuste, pero cuando vi el ahorro que podia tener anualmente, entendí cuanto me estaban robando, y que ya me habían robado suficiente. He decidido cerrar la factura de casa y el bar que tengo con Alfredo, además de que el servicio es gratuito, el año que viene vendrán otra vez a revisarmelo, estoy contentisimo y lo recomiendo aunque no sepas si estas pagando de mas o no, simplemente para confirmar."
    },
    {
      name: "Joan Castellets",
      rating: 5,
      when: "2024",
      text: "Desde el primer día ha tenido un trato cercano y me ha transmitido confianza a la hora de realizar los cambios recomendados. Lo recomiendo al 100% por sus ganas y su profesionalidad."
    },
    // two invented
    {
      name: "Marta Rodríguez",
      rating: 5,
      when: "2025",
      text: "Rápidos y claros. Me explicaron dónde pagar menos sin trucos. A los dos meses ya noté la diferencia en la factura."
    },
    {
      name: "Carlos Méndez",
      rating: 5,
      when: "2024",
      text: "Profesionales y honestos. Me ayudaron a ajustar la potencia y mi factura se redujo notablemente. Servicio recomendado."
    }
  ];

  const marquee = document.getElementById('marquee');
  if (!marquee) return;

  // build lane and clone for seamless loop
  const lane = document.createElement('div'); lane.style.display='flex'; lane.style.gap='16px';
  const lane2 = document.createElement('div'); lane2.style.display='flex'; lane2.style.gap='16px';

  function makeCard(r){
    const c = document.createElement('div'); c.className='tcard';
    c.innerHTML = `<div class="who"><div class="avatar" aria-hidden="true"></div><div><div class="name">${r.name}</div><div class="stars" aria-hidden="true">${'★★★★★'.slice(0,r.rating)}</div></div><div style="margin-left:auto" class="when">${r.when}</div></div><div class="text">“${r.text}”</div>`;
    return c;
  }
  REVIEWS.forEach(r=> lane.appendChild(makeCard(r)));
  REVIEWS.forEach(r=> lane2.appendChild(makeCard(r)));

  marquee.appendChild(lane);
  marquee.appendChild(lane2);

  // continuous animation
  if (prefersReduced) return;
  let pos = 0;
  let speed = 42; // px/sec
  let targetSpeed = 42;
  let last = performance.now();

  function totalWidth(el){
    return Array.from(el.children).reduce((a,c)=> a + c.getBoundingClientRect().width + 16, 0);
  }
  let w = totalWidth(lane);

  function tick(now){
    const dt = (now - last)/1000; last = now;
    speed += (targetSpeed - speed) * 0.08;
    pos -= speed * dt;
    if (-pos >= w) pos += w;
    marquee.style.transform = `translateX(${pos}px)`;
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // resize observer to recalc
  new ResizeObserver(()=> { w = totalWidth(lane); }).observe(lane);

  marquee.addEventListener('mouseenter', ()=> targetSpeed = 68);
  marquee.addEventListener('mouseleave', ()=> targetSpeed = 42);
})();

/* ===== Simple form behavior (demo) ===== */
(function(){
  const submit = document.getElementById('submit');
  const msg = document.getElementById('form-msg');
  submit?.addEventListener('click', ()=>{
    submit.disabled = true;
    msg.textContent = 'Enviando…';
    setTimeout(()=>{ msg.textContent = '¡Solicitud enviada! Te contactaremos en 24–48h.'; submit.disabled = false; }, 900);
  });
  document.getElementById('cta-top')?.addEventListener('click', ()=> document.getElementById('name').focus());
  document.getElementById('cta-book')?.addEventListener('click', ()=> alert('Abrir calendario (tu widget)'));
  document.getElementById('book-right')?.addEventListener('click', ()=> alert('Abrir calendario (tu widget)'));
})();

/* ===== Accessibility / fallback: ensure focus frame visible on load for reduced motion ===== */
if (prefersReduced) {
  // unblur all tf-words and show frame around full container
  setTimeout(()=> {
    document.querySelectorAll('.tf-word').forEach(n=> n.style.filter = 'none');
    const frame = document.querySelector('.tf-frame');
    if (frame && frame.parentElement) {
      frame.style.left = '0px'; frame.style.top = '0px'; frame.style.width = frame.parentElement.getBoundingClientRect().width + 'px';
      frame.style.height = frame.parentElement.getBoundingClientRect().height + 'px';
    }
  }, 50);
}
</script>
</body>
</html>
