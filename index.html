<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TrasLaFactura ‚Äî Revisi√≥n gratuita de tu factura de luz</title>
<meta name="description" content="An√°lisis profesional y sin coste de tu factura de luz. Detectamos sobrecostes y te proponemos un plan claro para pagar menos." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

<!-- Animaciones de entrada y t√≠tulo -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
<script defer src="https://unpkg.com/scrollreveal"></script>

<style>
:root{
  /* Paleta basada en el logo: blanco/negro + verde suave */
  --bg:#0b0b0b;              /* negro */
  --panel:#111315;           /* gris muy oscuro */
  --ink:#f6f7fb;             /* blanco suave */
  --muted:#c9ced7;           /* gris claro para textos secundarios */
  --line:rgba(255,255,255,.10);
  --accent:#77e3a1;          /* verde suave */
  --accent-700:#46c27a;
  --accent-900:#229055;
  --warn:#ffc857;
  --bad:#ff6b6b;
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;scroll-behavior:smooth}
a{color:var(--accent);text-decoration:none}
img{max-width:100%;display:block}
.container{width:min(1140px,92vw);margin:0 auto}

/* Aura de fondo (verde sutil) */
.aura{position:fixed; inset:0; z-index:-1; pointer-events:none; overflow:hidden;
  background: radial-gradient(60vmax 35vmax at 20% 15%, rgba(80,220,150,.12), transparent 60%),
              radial-gradient(50vmax 30vmax at 80% 20%, rgba(190,255,220,.09), transparent 60%),
              radial-gradient(70vmax 50vmax at 50% 90%, rgba(60,200,150,.07), transparent 60%),
              linear-gradient(180deg, #0b0b0b 0%, #0e0e0e 60%, #0b0b0b 100%);
  filter:saturate(1.05) blur(0.2px);
}
.aura::before, .aura::after{
  content:""; position:absolute; inset:-20%; mix-blend-mode:screen; opacity:.65; filter: blur(18px);
  background:
    radial-gradient(22rem 8rem at 20% 30%, rgba(40,210,120,.35), transparent 65%),
    radial-gradient(26rem 9rem at 80% 60%, rgba(140,255,200,.25), transparent 65%),
    radial-gradient(18rem 7rem at 50% 80%, rgba(60,240,160,.25), transparent 65%);
  animation: auraMove 20s linear infinite;
}
.aura::after{
  opacity:.5;
  background:
    radial-gradient(24rem 8rem at 70% 20%, rgba(40,210,120,.35), transparent 65%),
    radial-gradient(28rem 9rem at 30% 70%, rgba(140,255,200,.25), transparent 65%),
    radial-gradient(20rem 7rem at 40% 40%, rgba(60,240,160,.25), transparent 65%);
  animation-duration: 28s; animation-direction: reverse;
}
@keyframes auraMove{0%{transform:translate3d(-3%,-2%,0) rotate(0)}50%{transform:translate3d(3%,2%,0) rotate(180deg)}100%{transform:translate3d(-3%,-2%,0) rotate(360deg)}}
@media (prefers-reduced-motion: reduce){ .aura::before, .aura::after{ animation:none } }

/* Barra de progreso de lectura */
#progress{position:fixed;top:0;left:0;height:3px;background:linear-gradient(90deg,var(--accent),#d9ffd9);width:0;z-index:80}

/* Botones */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.6rem;padding:.95rem 1.1rem;border-radius:14px;border:1px solid transparent;font-weight:800;letter-spacing:.2px;cursor:pointer;transition:.2s ease}
.btn.primary{background:linear-gradient(135deg,var(--accent),#c7ffd9);color:#0f0f0f;box-shadow:0 12px 28px rgba(119,227,161,.22)}
.btn.primary:hover{filter:brightness(1.05)}
.btn.ghost{background:transparent;border-color:var(--line);color:var(--ink)}
.btn.ghost:hover{background:rgba(255,255,255,.06)}

/* Header full-bleed + scroll-spy activo */
.header,.hero{width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw)}
.header{position:sticky;top:0;z-index:70;background:rgba(11,11,11,.6);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
.header .row{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
.brand{display:flex;align-items:center;gap:.8rem}
.brand img{height:34px;width:auto}

/* Men√∫ con indicador animado */
.nav-inline{position:relative;display:flex;gap:1rem;align-items:center}
.nav-inline a{color:#eef3f9;font-weight:700;opacity:.95;padding:.5rem .3rem;position:relative}
.nav-inline a.active{color:var(--accent)}
.nav-inline .indicator{
  position:absolute; bottom:0; height:2px; width:0; background:linear-gradient(90deg,var(--accent),#d9ffd9);
  transition: transform .25s cubic-bezier(.22,1,.36,1), width .25s cubic-bezier(.22,1,.36,1);
  transform: translateX(0); border-radius:2px;
}

.menu-toggle{display:none;background:#151a1d;border:1px solid var(--line);color:#fff;border-radius:10px;padding:.5rem .7rem;font-weight:800}
.nav-tray{position:fixed;top:64px;left:12px;right:12px;z-index:75;background:#101315;border:1px solid var(--line);border-radius:16px;padding:12px;display:none;box-shadow:0 20px 50px rgba(0,0,0,.5)}
.nav-tray.open{display:block}
.nav-tray a{display:block;padding:.85rem 1rem;border-radius:12px;color:#eef3f9}
.nav-tray a:hover{background:rgba(255,255,255,.06)}

/* Hero ‚Äúsplit‚Äù con tarjeta KPIs */
.hero{position:relative;min-height:100svh;min-height:100dvh;display:grid;place-items:center;overflow:hidden}
.hero::before{content:"";position:absolute;inset:0;z-index:-1;background:
  radial-gradient(900px 480px at 85% 10%, rgba(119,227,161,.14), transparent 60%),
  radial-gradient(900px 480px at 15% 90%, rgba(119,227,161,.10), transparent 60%),
  linear-gradient(180deg, rgba(11,11,11,.25) 0%, rgba(11,11,11,.9) 70%, rgba(11,11,11,1) 100%)}
.hero .grid{display:grid;grid-template-columns:1.25fr .75fr;gap:24px;align-items:center}
.h1{font-size:clamp(2rem,3.6vw,3.2rem);line-height:1.05;margin:0 0 8px;font-weight:900}
.sub{max-width:720px;margin:0 0 14px;color:var(--muted)}
.hero .ctas{display:flex;gap:.8rem;flex-wrap:wrap}

/* Decrypted + True Focus */
.decrypted{font-weight:800;font-size: clamp(18px, 2.6vw, 28px);color:var(--accent);margin:.35rem 0 0}
.decrypted .enc{opacity:.7}
.true-focus{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:12px 0 8px;filter: drop-shadow(0 8px 26px rgba(255,255,255,.06))}
.chip{position:relative;padding:8px 14px;border-radius:14px;color:#fff;font-weight:900}
.chip::before{content:"";position:absolute;inset:0;border:2px solid rgba(255,255,255,.95);border-radius:14px;box-shadow:0 0 18px rgba(255,255,255,.25);animation:pulse 2.4s ease-in-out infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(255,255,255,.18)}50%{box-shadow:0 0 20px 6px rgba(255,255,255,.18)}}
.muted{color:#c9d6d1;opacity:.65}

/* KPIs */
.kpi-card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
.kpi-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.kpi{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:12px;padding:12px}
.kpi b{font-size:1.15rem;color:#fff}

/* Secciones comunes */
.section{padding:56px 0;border-top:1px solid var(--line)}
.section h2{font-size:clamp(1.5rem,2.2vw,2rem);margin:0 0 10px}
.section p.lead{color:#e1e7f0}

/* Valor / beneficios */
.value{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.value .item{display:flex;gap:12px;align-items:flex-start;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:14px;padding:14px}
.value .icon{font-size:1.1rem}

/* Comparativa */
.compare{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.compare .col{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
.compare .col h3{margin:.2rem 0 .6rem}
.bad{border-color:rgba(255,107,107,.25)}
.good{border-color:rgba(119,227,161,.35)}

/* M√©tricas (c√≠rculos) */
.stats{display:grid;grid-template-columns:repeat(2, minmax(220px, 1fr)); gap:22px; align-items:center; justify-items:center}
.circle{position:relative; width:240px; height:240px; border-radius:50%; display:grid; place-items:center; background: radial-gradient(120px 120px at center, rgba(223,247,230,.06), transparent 60%)}
.ring{position:absolute; inset:0; border-radius:50%; will-change:transform}
.ring span{position:absolute; left:50%; top:50%; transform-origin:0 0; font-size:14px; letter-spacing:1px; color:#dff7e6}
.center{position:relative; z-index:1; text-align:center; background:rgba(223,247,230,.06); border:1px solid rgba(223,247,230,.18); border-radius:16px; padding:16px 18px; min-width:160px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
.center .big{font-size:clamp(22px, 4.2vw, 32px); font-weight:900; color:#fff; line-height:1}
.center .sub{font-size:13px; color:#9fb0a8; margin-top:6px}
.shiny{display:inline-block; font-weight:900; background: linear-gradient(120deg, #ffffff 0%, #bdeed0 25%, #18a957 50%, #bdeed0 75%, #ffffff 100%); -webkit-background-clip:text; background-clip:text; color: transparent; animation: shimmer var(--speed, 5s) linear infinite}
@keyframes shimmer{0%{background-position:0% 50%}100%{background-position:200% 50%}}
@media (prefers-reduced-motion: reduce){ .shiny{animation:none; color:#fff; -webkit-text-fill-color:#fff} }

/* FORM Premium + Laser Flow */
.form-shell{background:var(--panel);border:1px solid var(--line);border-radius:20px;padding:18px;position:relative;overflow:hidden}
.form-shell .flow{position:absolute; inset:-20%; z-index:0; filter: blur(16px) saturate(1.1); opacity:.75; mix-blend-mode:screen; pointer-events:none;
  background:
    radial-gradient(22rem 8rem at 20% 30%, rgba(40,210,120,.45), transparent 65%),
    radial-gradient(26rem 9rem at 80% 60%, rgba(190,255,220,.35), transparent 65%),
    radial-gradient(18rem 7rem at 50% 80%, rgba(60,240,160,.28), transparent 65%);
  animation: flowMove 16s linear infinite;
}
.form-shell .flow::after{content:""; position:absolute; inset:0; background:
    radial-gradient(24rem 8rem at 70% 20%, rgba(40,210,120,.45), transparent 65%),
    radial-gradient(28rem 9rem at 30% 70%, rgba(190,255,220,.35), transparent 65%),
    radial-gradient(20rem 7rem at 40% 40%, rgba(60,240,160,.28), transparent 65%); animation: flowMove 22s linear infinite reverse; opacity:.6}
@keyframes flowMove{0%{transform:translate(-4%,-3%) rotate(0)}50%{transform:translate(4%,3%) rotate(180deg)}100%{transform:translate(-4%,-3%) rotate(360deg)}}

/* Form layout */
.form-grid{display:grid;grid-template-columns:1fr .9fr;gap:18px}
@media (max-width:980px){.form-grid{grid-template-columns:1fr}}
.form h3{margin:0 0 10px}
.progress{height:10px;background:#16191c;border:1px solid var(--line);border-radius:999px;overflow:hidden;margin:8px 0 16px}
.progress .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#d8ffe8)}
.form .row{display:grid;gap:10px}
.input, .select, .textarea{
  background:#121416;border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:.85rem .95rem;color:#eef3f9;width:100%;transition:.15s
}
.input:focus,.select:focus,.textarea:focus{outline:none;box-shadow:0 0 0 2px rgba(119,227,161,.25);border-color:rgba(119,227,161,.35)}
label{font-weight:800;color:#e9eef6;margin-bottom:.35rem;display:block}
.hint{font-size:.9rem;color:#aeb9c7}
.inline{display:flex;gap:10px;flex-wrap:wrap}
.inline .input{flex:1 1 220px}

/* Drag & drop */
.drop{background:#121416;border:1px dashed rgba(255,255,255,.24);border-radius:12px;padding:14px;text-align:center;color:#cfd6df}
.drop.drag{background:#15181b;border-color:var(--accent)}
.preview{margin-top:10px;display:none}
.preview .file{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:10px;padding:8px}

/* Consentimiento */
.consent{display:flex;gap:10px;align-items:flex-start}
.consent input{margin-top:.2rem}

/* CTA m√≥vil */
.sticky-cta{position:fixed;left:12px;right:12px;bottom:12px;z-index:60;display:flex;gap:10px;justify-content:center;opacity:0;pointer-events:none;transform:translateY(8px);transition:.25s ease}
.sticky-cta.show{opacity:1;pointer-events:auto;transform:translateY(0)}

/* Responsive */
@media (max-width:980px){
  .nav-inline{display:none}
  .menu-toggle{display:inline-flex}
  .hero .grid{grid-template-columns:1fr}
  .value{grid-template-columns:1fr}
  .compare{grid-template-columns:1fr}
}
@media (prefers-reduced-motion: reduce){
  *{scroll-behavior:auto!important;transition:none!important;animation:none!important}
}
</style>
</head>
<body>
<div class="aura" aria-hidden="true"></div>
<div id="progress" aria-hidden="true"></div>

<header class="header" id="top">
  <div class="container row">
    <div class="brand">
      <img src="https://storage.googleapis.com/msgsndr/JGkHaKDrqyLJGaAenUBK/media/68f7c75b57ab4837ff3fa0f8.png" alt="TrasLaFactura" />
    </div>
    <nav class="nav-inline" id="mainnav">
      <a href="#valor">Valor</a>
      <a href="#comparativa">Comparativa</a>
      <a href="#metricas">M√©tricas</a>
      <a href="#form">Contacto</a>
      <span class="indicator" aria-hidden="true"></span>
      <button class="btn ghost" id="open-calendar">Reserva 10‚Äô</button>
    </nav>
    <button class="menu-toggle" id="menu-toggle" aria-expanded="false" aria-controls="nav-tray">‚ò∞</button>
  </div>
  <div class="nav-tray" id="nav-tray">
    <a href="#valor" class="nav-link">Valor</a>
    <a href="#comparativa" class="nav-link">Comparativa</a>
    <a href="#metricas" class="nav-link">M√©tricas</a>
    <a href="#form" class="nav-link">Contacto</a>
    <button class="btn ghost" id="open-calendar-m">Reserva 10‚Äô</button>
  </div>
</header>

<section class="hero" id="hero">
  <div class="container grid">
    <div data-sr>
      <h1 class="h1" id="title">Revisi√≥n profesional para <span style="color:var(--accent)">pagar menos</span> por tu luz</h1>

      <!-- Decrypted -->
      <p id="decrypted" class="decrypted">
        <span class="enc">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
      </p>

      <!-- True Focus -->
      <div class="true-focus">
        <span class="muted">Analizamos tu factura y</span>
        <span class="chip">ENCONTRAMOS</span>
        <span class="chip">SOBRECOSTES</span>
        <span class="muted">que puedes evitar.</span>
      </div>

      <p class="sub">Analizamos tu contrato y consumos para detectar sobrecostes y proponerte un plan claro, sin letra peque√±a. Hogares, pymes y comunidades.</p>
      <div class="ctas">
        <a href="#form" class="btn primary">Quiero mi revisi√≥n gratuita</a>
        <button class="btn ghost" id="open-calendar-hero">Reservar 10‚Äô</button>
      </div>
    </div>

    <aside class="kpi-card" aria-labelledby="kpis-title" data-sr>
      <h3 id="kpis-title" style="margin:0 0 10px">Resultados que importan</h3>
      <div class="kpi-grid">
        <div class="kpi"><b>18‚Äì25%</b><div class="hint">Ahorro medio estimado*</div></div>
        <div class="kpi"><b>24‚Äì48h</b><div class="hint">Informe inicial</div></div>
        <div class="kpi"><b>+96k</b><div class="hint">Facturas revisadas</div></div>
        <div class="kpi"><b>9,4/10</b><div class="hint">Satisfacci√≥n</div></div>
      </div>
      <div class="hint" style="margin-top:10px">*Depende de condiciones y consumo actuales.</div>
    </aside>
  </div>
</section>

<section id="valor" class="section" data-sr>
  <div class="container">
    <h2>Qu√© obtienes</h2>
    <p class="lead">Valor concreto, explicado en sencillo.</p>
    <div class="value">
      <div class="item"><div class="icon">üìä</div><div><b>Informe ejecutivo</b><div class="hint">Resumen de ahorro y recomendaci√≥n.</div></div></div>
      <div class="item"><div class="icon">‚öô</div><div><b>Optimizaci√≥n real</b><div class="hint">Tarifa, potencia y servicios ajustados.</div></div></div>
      <div class="item"><div class="icon">ü§ù</div><div><b>Acompa√±amiento</b><div class="hint">Si lo decides, tramitamos los cambios.</div></div></div>
    </div>
  </div>
</section>

<section id="comparativa" class="section" data-sr>
  <div class="container">
    <h2>Antes / Despu√©s</h2>
    <div class="compare">
      <div class="col bad">
        <h3>Antes</h3>
        <ul class="hint" style="margin:0 0 0 18px;line-height:1.6">
          <li>Precio por kWh por encima de mercado</li>
          <li>Potencia sobredimensionada</li>
          <li>Servicios que no aportan</li>
        </ul>
      </div>
      <div class="col good">
        <h3>Despu√©s</h3>
        <ul class="hint" style="margin:0 0 0 18px;line-height:1.6">
          <li>Propuesta optimizada y cuantificada</li>
          <li>Potencia ajustada a tu perfil</li>
          <li>Decisi√≥n informada y sin prisas</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- M√âTRICAS (c√≠rculos) -->
<section id="metricas" class="section" data-sr>
  <div class="container">
    <h2>M√©tricas</h2>
    <p class="lead">Confianza basada en experiencia real.</p>
    <div class="stats">
      <div class="circle">
        <div class="ring" data-ring data-text="+100.000 CLIENTES ‚Ä¢ " data-radius="98" data-speed="0.7" data-hover="speedUp"></div>
        <div class="center"><div class="big"><span class="shiny" style="--speed:4s">+100.000</span></div><div class="sub">clientes</div></div>
      </div>
      <div class="circle">
        <div class="ring" data-ring data-text="+15 A√ëOS DE EXPERIENCIA ‚Ä¢ " data-radius="98" data-speed="0.55" data-hover="slowDown"></div>
        <div class="center"><div class="big"><span class="shiny" style="--speed:6s">+15</span></div><div class="sub">a√±os de experiencia</div></div>
      </div>
    </div>
  </div>
</section>

<section id="form" class="section" data-sr>
  <div class="container">
    <div class="form-shell">
      <div class="flow" aria-hidden="true"></div>
      <div class="form-grid">
        <!-- Formulario PREMIUM (custom) -->
        <div class="form" aria-labelledby="form-title">
          <h3 id="form-title">Solicitar revisi√≥n gratuita</h3>
          <div class="progress" aria-hidden="true"><div class="bar" id="f-bar"></div></div>

          <!-- Paso 1: datos b√°sicos -->
          <form id="tlf-form" novalidate>
            <div class="step" data-step="1">
              <div class="row">
                <div>
                  <label for="name">Nombre</label>
                  <input id="name" name="name" class="input" type="text" autocomplete="name" required />
                </div>
                <div class="inline">
                  <div style="flex:0 0 110px">
                    <label for="cc">Prefijo</label>
                    <select id="cc" name="cc" class="select">
                      <option value="+34" selected>+34 ES</option>
                      <option value="+351">+351 PT</option>
                      <option value="+33">+33 FR</option>
                      <option value="+39">+39 IT</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <label for="phone">Tel√©fono</label>
                    <input id="phone" name="phone" class="input" type="tel" inputmode="tel" autocomplete="tel" required />
                  </div>
                </div>
                <div>
                  <label for="email">Email (opcional)</label>
                  <input id="email" name="email" class="input" type="email" autocomplete="email" />
                </div>
              </div>
              <div class="inline" style="margin-top:8px">
                <button class="btn primary" type="button" id="to-step-2">Continuar</button>
                <a class="btn ghost" id="quick-calendar">Prefiero reservar 10‚Äô</a>
              </div>
            </div>

            <!-- Paso 2: suministro -->
            <div class="step" data-step="2" hidden>
              <div class="row">
                <div class="inline">
                  <div style="flex:1">
                    <label for="kwh">Consumo mensual aprox. (kWh)</label>
                    <input id="kwh" name="kwh" class="input" type="number" min="0" step="1" placeholder="p. ej. 300" />
                  </div>
                  <div style="flex:1">
                    <label for="price">Precio actual (‚Ç¨/kWh)</label>
                    <input id="price" name="price" class="input" type="number" min="0" step="0.001" placeholder="p. ej. 0.23" />
                  </div>
                </div>
                <div class="inline">
                  <div style="flex:1">
                    <label for="power">Potencia contratada (kW)</label>
                    <input id="power" name="power" class="input" type="number" min="0" step="0.1" placeholder="p. ej. 4.6" />
                  </div>
                  <div style="flex:1">
                    <label for="type">Tipo de cliente</label>
                    <select id="type" name="type" class="select">
                      <option value="hogar" selected>Hogar</option>
                      <option value="pyme">Pyme</option>
                      <option value="comunidad">Comunidad</option>
                    </select>
                  </div>
                </div>

                <!-- Drag & drop factura -->
                <div>
                  <label>Adjuntar √∫ltima factura (PDF/JPG/PNG) <span class="hint">(m√°x. 8 MB)</span></label>
                  <div class="drop" id="drop">
                    Arrastra y suelta aqu√≠ o <u>haz clic</u> para elegir
                    <input id="file" name="file" type="file" accept=".pdf,image/*" hidden />
                  </div>
                  <div class="preview" id="preview">
                    <div class="file"><span id="fname"></span> ‚Ä¢ <span id="fsize"></span></div>
                  </div>
                </div>
              </div>
              <div class="inline" style="margin-top:8px">
                <button class="btn ghost" type="button" id="back-1">‚Üê Atr√°s</button>
                <button class="btn primary" type="button" id="to-step-3">Continuar</button>
              </div>
            </div>

            <!-- Paso 3: privacidad + env√≠o -->
            <div class="step" data-step="3" hidden>
              <div class="row">
                <div class="consent">
                  <input id="consent" type="checkbox" required />
                  <label for="consent" class="hint">Acepto recibir comunicaciones sobre mi revisi√≥n y propuestas de ahorro por los medios de contacto que proporciono. Puedo revocar el consentimiento en cualquier momento.</label>
                </div>
                <!-- Honeypot + timestamp anti-spam -->
                <input id="hp" name="company" type="text" style="position:absolute;left:-9999px" tabindex="-1" autocomplete="off" />
                <input id="ts" name="ts" type="hidden" />
                <!-- UTMs hidden -->
                <input type="hidden" name="utm_source" />
                <input type="hidden" name="utm_medium" />
                <input type="hidden" name="utm_campaign" />
                <input type="hidden" name="utm_content" />
                <input type="hidden" name="utm_term" />
                <input type="hidden" name="gclid" />
                <input type="hidden" name="fbclid" />
                <input type="hidden" name="entry_channel" value="Landing" />
                <input type="hidden" name="city" value="Castro Urdiales" />
                <input type="hidden" name="referrer_url" />
              </div>
              <div class="inline" style="margin-top:8px">
                <button class="btn ghost" type="button" id="back-2">‚Üê Atr√°s</button>
                <button class="btn primary" type="submit" id="submit-btn">Enviar solicitud</button>
              </div>
              <div class="hint" style="margin-top:8px">Al enviar aceptas nuestras <a href="https://traslafactura.com/aviso-legal" target="_blank" rel="noopener">condiciones</a>, <a href="https://traslafactura.com/politica-de-privacidad" target="_blank" rel="noopener">privacidad</a> y <a href="https://traslafactura.com/poltica-de-coockies" target="_blank" rel="noopener">cookies</a>.</div>
            </div>

            <!-- Estado -->
            <div id="status" class="hint" style="margin-top:10px"></div>
          </form>
        </div>

        <!-- Columna auxiliar: agenda y contacto r√°pido -->
        <div class="form" data-sr>
          <h3>¬øPrefieres hablar 10‚Äô?</h3>
          <p class="hint">Elige d√≠a y hora ahora mismo.</p>
          <button class="btn ghost" id="open-calendar-form">Reservar 10‚Äô</button>
          <hr style="border:none;border-top:1px solid var(--line);margin:16px 0">
          <h3>¬øWhatsApp o tel√©fono?</h3>
          <p class="hint">Ll√°manos al <a href="tel:+34640225977">+34 640 225 977</a> o escr√≠benos por WhatsApp.</p>
          <a id="wa-form" class="btn primary" target="_blank" rel="noopener" href="https://wa.me/34640225977?text=Quiero%20mi%20revisi%C3%B3n%20gratuita">Abrir WhatsApp</a>
        </div>
      </div>
    </div>
  </div>
</section>

<footer class="section" style="padding:28px 0">
  <div class="container" style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <div>¬© TrasLaFactura ‚Ä¢ 2025</div>
    <nav style="display:flex;gap:14px;flex-wrap:wrap">
      <a href="#top">Arriba</a>
      <a href="https://traslafactura.com/aviso-legal" target="_blank" rel="noopener">Aviso legal</a>
      <a href="https://traslafactura.com/politica-de-privacidad" target="_blank" rel="noopener">Privacidad</a>
      <a href="https://traslafactura.com/poltica-de-coockies" target="_blank" rel="noopener">Cookies</a>
    </nav>
  </div>
</footer>

<!-- CTA m√≥vil -->
<div class="sticky-cta">
  <a href="#form" class="btn primary" style="flex:1">Revisi√≥n gratuita</a>
  <button class="btn ghost" id="open-calendar-sticky">Reserva 10‚Äô</button>
</div>

<script>
/* ===== Config ===== */
const WEBHOOK_URL = "https://services.leadconnectorhq.com/hooks/JGkHaKDrqyLJGaAenUBK/webhook-trigger/KBjc4OY60qRNIeDa2Z1A";

/* ===== Helpers ===== */
const qs=(s,el=document)=>el.querySelector(s);
const qsa=(s,el=document)=>[...el.querySelectorAll(s)];
const getParams=()=>Object.fromEntries(new URLSearchParams(location.search));
const fmtMB = b => (b/1024/1024).toFixed(2)+' MB';
const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

/* ===== Barra progreso + indicador de men√∫ animado + scroll-spy ===== */
(function(){
  const bar=qs('#progress');
  const onscroll=()=>{ const h=document.documentElement, sc=h.scrollTop, max=h.scrollHeight-h.clientHeight; bar.style.width=(max?(sc/max*100):0)+'%'; };
  document.addEventListener('scroll', onscroll, {passive:true}); onscroll();

  const sections=['valor','comparativa','metricas','form'].map(id=>qs('#'+id)).filter(Boolean);
  const nav=qs('#mainnav'); const links=qsa('#mainnav a[href^="#"]');
  const indicator=qs('.indicator', nav);

  function moveIndicator(el){
    const r = el.getBoundingClientRect(), nr = nav.getBoundingClientRect();
    const w = r.width; const x = r.left - nr.left;
    indicator.style.width = w + 'px';
    indicator.style.transform = `translateX(${x}px)`;
  }

  const map=new Map(sections.map(s=>[s.id, [...links].find(a=>a.getAttribute('href')==='#'+s.id)]));
  const io=new IntersectionObserver(entries=>{
    entries.forEach(e=>{ const l=map.get(e.target.id); if(!l) return;
      if(e.isIntersecting){
        links.forEach(a=>a.classList.remove('active'));
        l.classList.add('active');
        moveIndicator(l);
      }
    });
  },{rootMargin:'-40% 0px -55% 0px',threshold:0.01});
  sections.forEach(s=>io.observe(s));

  // En hover tambi√©n mueve el indicador (sin romper el activo)
  links.forEach(a=>{
    a.addEventListener('mouseenter', ()=> moveIndicator(a));
    a.addEventListener('mouseleave', ()=>{
      const active = qs('#mainnav a.active') || links[0];
      moveIndicator(active);
    });
  });

  // Inicial
  window.addEventListener('load', ()=>{
    const active = qs('#mainnav a.active') || links[0];
    if(active) moveIndicator(active);
  });
})();

/* ===== Men√∫ m√≥vil ===== */
(function(){
  const btn=qs('#menu-toggle'), tray=qs('#nav-tray'), links=qsa('.nav-link');
  const toggle=()=>{ const open=tray.classList.toggle('open'); btn.setAttribute('aria-expanded', String(open)); };
  btn?.addEventListener('click', toggle);
  links.forEach(a=>a.addEventListener('click', ()=> tray.classList.remove('open')));
  addEventListener('resize', ()=>{ if(innerWidth>980) tray.classList.remove('open'); });
})();

/* ===== UTM manager (guarda + rellena ocultos + WhatsApp/Calendario) ===== */
(function utmManager(){
  const wanted=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","fbclid"];
  const urlP=getParams(); const KEY="tlf_attr";
  let saved={}; try{ saved=JSON.parse(localStorage.getItem(KEY)||"{}"); }catch(e){}
  if(!saved.first_referrer) saved.first_referrer=document.referrer||"(direct)";
  wanted.forEach(k=>{ if(urlP[k]) saved[k]=urlP[k]; });
  saved.entry_channel="Landing"; saved.city="Castro Urdiales"; saved.referrer_url=document.referrer||saved.referrer_url||"";
  localStorage.setItem(KEY, JSON.stringify(saved));

  // Rellenar ocultos
  wanted.concat(["entry_channel","city","referrer_url"]).forEach(k=>{
    const el=document.querySelector(`[name="${k}"]`); if(el) el.value=saved[k]||"";
  });

  // Enlaces con UTM
  function withUTM(href){
    const u=new URL(href, location.href);
    Object.entries(saved).forEach(([k,v])=>{ if(v) u.searchParams.set(k,v); });
    new URLSearchParams(location.search).forEach((v,k)=>{ if(!u.searchParams.has(k)) u.searchParams.set(k,v); });
    return u.toString();
  }
  const wa=qs('#wa-form'); if(wa) wa.href = withUTM(wa.href);
  window._buildBookingURL = ()=> withUTM('https://api.leadconnectorhq.com/widget/booking/BNqiWlZPpe9yYWHxODLY');
})();

/* ===== Calendario ===== */
(function(){
  function openCal(e){ if(e) e.preventDefault(); const url=(window._buildBookingURL&&window._buildBookingURL())||'https://api.leadconnectorhq.com/widget/booking/BNqiWlZPpe9yYWHxODLY';
    const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if(isMobile) location.href=url; else { const w=window.open(url,'_blank','noopener'); if(!w) location.href=url; }
  }
  ['#open-calendar','#open-calendar-hero','#open-calendar-form','#open-calendar-sticky','#open-calendar-m']
    .forEach(sel=>{ const el=qs(sel); if(el){ el.addEventListener('click', openCal); if(el.tagName==='A'){ el.href=(window._buildBookingURL&&window._buildBookingURL())||el.href; el.target='_blank'; el.rel='noopener'; } }});
})();

/* ===== CTA m√≥vil tras salir del hero ===== */
(function(){
  const sticky=qs('.sticky-cta'), hero=qs('#hero');
  const io=new IntersectionObserver(([e])=>{ if(e.isIntersecting) sticky.classList.remove('show'); else sticky.classList.add('show'); },{threshold:0.15});
  io.observe(hero);
})();

/* ===== Scroll Reveal (toda la p√°gina) ===== */
(function(){
  if (!window.ScrollReveal || prefersReduced) return;
  ScrollReveal().reveal("[data-sr]", {
    distance:"24px",
    duration:800,
    easing:"cubic-bezier(0.22,1,0.36,1)",
    interval:80,
    origin:"bottom",
    cleanup:true
  });
})();

/* ===== GSAP: T√≠tulo por letras ===== */
(function(){
  function splitToChars(el){
    const t=el.textContent.trim(); el.textContent="";
    const f=document.createDocumentFragment();
    for(const c of t){ const s=document.createElement("span"); s.className="char"; s.textContent=(c===" ")?"\u00A0":c; f.appendChild(s); }
    el.appendChild(f); return [...el.querySelectorAll(".char")];
  }
  const el=qs('#title'); if(!el || prefersReduced || !window.gsap) return;
  gsap.registerPlugin(ScrollTrigger);
  const chars=splitToChars(el);
  chars.forEach(c=>{ c.style.opacity=0; c.style.transform="translateY(32px)"; });
  gsap.to(chars,{ opacity:1, y:0, duration:.55, ease:"power3.out", stagger:.02, scrollTrigger:{trigger:el, start:"top 80%", once:true} });
})();

/* ===== Decrypted Text ===== */
(function(){
  const el=qs('#decrypted'); if(!el) return;
  const finalMsg = "Te ayudamos a entender la factura de la luz, y lo m√°s importante, que AHORRES";
  if (prefersReduced){ el.textContent = finalMsg; return; }
  const chars="-_~`!@#$%^&*()+=[]{}|;:,.<>/?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let frame=0; const out=finalMsg.split("").map(()=>({ch:"",lock:false}));
  const timer=setInterval(()=>{
    let done=0;
    for(let i=0;i<out.length;i++){
      if(finalMsg[i]===" "){ out[i]={ch:" ",lock:true}; done++; continue; }
      if(!out[i].lock){
        if(frame> i + Math.random()*14) out[i]={ch:finalMsg[i],lock:true};
        else out[i]={ch: chars[(Math.random()*chars.length)|0], lock:false};
      } else done++;
    }
    el.textContent=out.map(o=>o.ch).join("");
    if(done===out.length) clearInterval(timer);
    frame++;
  },22);
})();

/* ===== C√≠rculos m√©tricas (texto circular + rotaci√≥n suave rAF) ===== */
(function(){
  function buildRing(el,text,radius){
    el.innerHTML=""; const chars=[...text]; const total=chars.length;
    for(let i=0;i<total;i++){ const s=document.createElement("span"); const a=(360/total)*i;
      s.style.transform=`translate(-50%,-50%) rotate(${a}deg) translate(${radius}px) rotate(${-a}deg)`; s.textContent=chars[i]; el.appendChild(s); }
  }
  function spinRing(el, baseRps=0.6, hoverMode="speedUp"){
    if(prefersReduced) return;
    let factor=1, target=1, last=performance.now();
    function tick(now){
      const dt=(now-last)/1000; last=now; factor+=(target-factor)*0.1;
      const prev=parseFloat(el._angle||0); const next=prev+(baseRps*factor*360*dt); el._angle=next%360;
      el.style.transform=`rotate(${el._angle}deg)`; requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
    const modes={speedUp:3.2, slowDown:0.45, goBonkers:10, steady:1};
    el.addEventListener("mouseenter", ()=> target = modes[hoverMode] ?? 1, {passive:true});
    el.addEventListener("mouseleave", ()=> target = 1, {passive:true});
  }
  qsa('[data-ring]').forEach(el=>{
    buildRing(el, el.dataset.text || "CIRCULAR ‚Ä¢ TEXT ‚Ä¢ ", parseFloat(el.dataset.radius || "98"));
    spinRing(el, parseFloat(el.dataset.speed || "0.6"), el.dataset.hover || "speedUp");
  });
})();

/* ===== Form premium: multistep, validaci√≥n, drag&drop, env√≠o a webhook ===== */
(function(){
  const form = qs('#tlf-form');
  const steps = qsa('.step', form);
  const bar = qs('#f-bar');
  const status = qs('#status');
  const ts = qs('#ts'); ts.value = String(Date.now());

  const go = n => {
    steps.forEach((s,i)=> s.hidden = i !== (n-1));
    bar.style.width = ((n-1)/(steps.length-1))*100 + '%';
    form.dataset.step = String(n);
  };
  go(1);

  // Navegaci√≥n
  qs('#to-step-2').addEventListener('click', ()=>{
    if (!validateStep1()) return;
    go(2);
  });
  qs('#back-1').addEventListener('click', ()=> go(1));
  qs('#to-step-3').addEventListener('click', ()=> go(3));
  qs('#back-2').addEventListener('click', ()=> go(2));

  // Validaci√≥n b√°sica + formato tel√©fono
  const cc = qs('#cc'), phone = qs('#phone'), email = qs('#email'), name = qs('#name');
  function formatPhone(){
    let val = phone.value.replace(/[^\d]/g,'');
    phone.value = val.replace(/(\d{3})(?=\d)/g,'$1 ').trim();
  }
  phone.addEventListener('input', formatPhone);

  function validateStep1(){
    let ok = true;
    if(!name.value.trim()){ ok=false; mark(name,'Indica tu nombre'); } else clear(name);
    const hasPhone = phone.value.replace(/\D/g,'').length >= 9;
    const hasEmail = email.value ? /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value) : false;
    if(!hasPhone && !hasEmail){ ok=false; mark(phone,'Tel√©fono (9 d√≠gitos) o email v√°lido'); mark(email,''); }
    else { if(hasPhone) clear(phone); if(hasEmail||!email.value) clear(email); }
    return ok;
  }
  function mark(el,msg){ el.classList.add('error'); el.style.borderColor='rgba(255,107,107,.65)'; if(msg) status.textContent=msg; }
  function clear(el){ el.classList.remove('error'); el.style.borderColor='rgba(255,255,255,.14)'; status.textContent=''; }

  // Drag & drop archivo
  const drop = qs('#drop'), fileInput = qs('#file'), preview = qs('#preview'), fname = qs('#fname'), fsize=qs('#fsize');
  const MAX = 8 * 1024 * 1024; // 8 MB
  function handleFiles(files){
    const f = files[0]; if(!f) return;
    if(!/pdf|image\//i.test(f.type)){ status.textContent='Formato no admitido. Sube PDF o imagen.'; return; }
    if(f.size > MAX){ status.textContent='Archivo demasiado grande (m√°x. 8 MB).'; return; }
    fileInput.files = files;
    fname.textContent = f.name; fsize.textContent = fmtMB(f.size);
    preview.style.display='block';
  }
  drop.addEventListener('click', ()=> fileInput.click());
  drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('drag'); });
  drop.addEventListener('dragleave', ()=> drop.classList.remove('drag'));
  drop.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('drag'); handleFiles(e.dataTransfer.files); });
  fileInput.addEventListener('change', e=> handleFiles(e.target.files));

  // Guardado de borrador
  const draftKey='tlf_draft';
  function saveDraft(){
    const d={name:name.value,email:email.value,phone:phone.value,cc:cc.value,
      kwh:qs('#kwh').value,price:qs('#price').value,power:qs('#power').value,type:qs('#type').value};
    localStorage.setItem(draftKey, JSON.stringify(d));
  }
  qsa('input,select,textarea', form).forEach(el=> el.addEventListener('input', saveDraft));
  try{ const d=JSON.parse(localStorage.getItem(draftKey)||'{}');
    if(d.name) name.value=d.name; if(d.email) email.value=d.email; if(d.phone) phone.value=d.phone; if(d.cc) cc.value=d.cc;
    ['kwh','price','power','type'].forEach(id=>{ if(d[id]) qs('#'+id).value=d[id]; });
  }catch(e){}

  // Env√≠o a Webhook
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(!qs('#consent').checked){ status.textContent='Debes aceptar el consentimiento.'; return; }
    if(qs('#hp').value){ status.textContent='Bloqueado por antispam.'; return; } // honeypot
    const submitBtn = qs('#submit-btn'); submitBtn.disabled = true; status.textContent='Enviando‚Ä¶';

    const data = new FormData(form);
    // Normalizamos tel√©fono
    const raw = phone.value.replace(/\D/g,'');
    data.set('phone', raw ? `${cc.value} ${raw}` : '');

    // Adjuntamos archivo como base64 (si hay)
    let filePayload = null;
    const f = fileInput.files?.[0];
    if(f){
      const arr = await f.arrayBuffer();
      const b64 = btoa(String.fromCharCode(...new Uint8Array(arr)));
      filePayload = { attachment_name: f.name, attachment_mime: f.type, attachment_base64: b64 };
    }

    // UTMs desde localStorage
    let utm={}; try{ utm = JSON.parse(localStorage.getItem('tlf_attr')||'{}'); }catch(_){}
    const payload = {
      source: "Landing TrasLaFactura",
      submitted_at: new Date().toISOString(),
      fields: Object.fromEntries(data.entries()),
      ...utm,
      ...(filePayload || {})
    };

    async function trySendCors(){
      const r = await fetch(WEBHOOK_URL, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
      if(!r.ok) throw new Error('HTTP '+r.status);
    }
    async function sendNoCors(){
      await fetch(WEBHOOK_URL, {method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    }

    try{
      await trySendCors();
      status.textContent='¬°Solicitud enviada! Te contactaremos en 24‚Äì48h. Puedes reservar 10‚Äô ahora si lo prefieres.';
    }catch(err){
      await sendNoCors();
      status.textContent='¬°Solicitud enviada (modo seguro)! Si no recibes confirmaci√≥n por email, escr√≠benos por WhatsApp.';
    }finally{
      submitBtn.disabled=false;
      const url=(window._buildBookingURL&&window._buildBookingURL())||'https://api.leadconnectorhq.com/widget/booking/BNqiWlZPpe9yYWHxODLY';
      try{ const w=window.open(url,'blank','noopener'); if(!w) location.href=url; }catch(){}
      localStorage.removeItem('tlf_draft');
      form.reset(); // reset
      qsa('.step', form).forEach((s,i)=> s.hidden = i!==0); qs('#f-bar').style.width='0%';
      qs('[name="referrer_url"]').value = document.referrer || '';
      qs('#ts').value = String(Date.now());
    }
  });

  // Botones r√°pidos
  qs('#quick-calendar').addEventListener('click', (e)=>{ e.preventDefault(); document.getElementById('open-calendar-form').click(); });
})();

/* ===== CTA m√≥vil: mostrar al salir del hero ===== */
(function(){
  const sticky=qs('.sticky-cta'), hero=qs('#hero');
  const io=new IntersectionObserver(([e])=>{ if(e.isIntersecting) sticky.classList.remove('show'); else sticky.classList.add('show'); },{threshold:0.15});
  io.observe(hero);
})();
</script>
</body>
</html>
